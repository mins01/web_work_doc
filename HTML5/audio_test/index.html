<!doctype html>
<html lang="ko" >
<head>
	<title>audio_test</title>
	<meta charset="utf-8">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="shortcut icon" href="http://www.mins01.com/favicon.ico">	
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	
	<script src="/js/ForGoogle.js"></script>
	<!-- google analytics -->
	<script>ForGoogle.analytics()</script>
	
	
	<!-- jquery 관련 -->
	<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
	
	<!-- 부트스트랩 4 : IE8지원안됨! -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" crossorigin="anonymous"> 
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" crossorigin="anonymous"></script> 
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>
	<!-- vue.js -->
	<script src="https://cdn.jsdelivr.net/npm/vue"></script>
	
	<!-- meta og -->
	
	<meta property="og:title" content="audio_test">
	<meta property="og:description" content="audio_test">
	<meta name="og:image" content="http://www.mins01.com/img/logo.gif">
	<meta property="og:image:width" content="190">
	<meta property="og:image:height" content="70" />
	<meta property="og:site_name" content="audio_test" />
	<meta property="og:type" content="website">
	
	<!-- //meta og -->
	<style>
		progress{width:300px}
	</style>
	
	<script>
		let app;
		window.onload=function(){
			app = new Vue({
				el: '#app',
				data: {
					freqs:[],
					timeDomains:[],
				}
			})
		}
	</script>
</head>
<body>
	<div class="container">
		<h1>audio test</h1>
		<ul class="list-group">
			<li class="list-group-item"><a href="https://developer.mozilla.org/ko/docs/Web/HTML/Element/audio">https://developer.mozilla.org/ko/docs/Web/HTML/Element/audio</a></li>
			<li class="list-group-item"><a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/AudioContext">https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/AudioContext</a></li>
			<li class="list-group-item"><a href="https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode/AnalyserNode">https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode/AnalyserNode</a></li>
			<li class="list-group-item"><a href="https://pks2974.medium.com/web-audio-%EA%B0%84%EB%8B%A8-%EC%A0%95%EB%A6%AC%ED%95%98%EA%B8%B0-952a19d6aa45">https://pks2974.medium.com/web-audio-%EA%B0%84%EB%8B%A8-%EC%A0%95%EB%A6%AC%ED%95%98%EA%B8%B0-952a19d6aa45</a></li>
			
			
		</ul>
		<hr>
		<div class="text-center">
			<audio style="width:300px;" controls  id="my-audio" src="mp3/Classic_Chopin_op25_9.mp3">
				<!-- <source src="mp3/Classic_Chopin_op25_9.mp3" type="audio/mpeg"> -->
			</audio>
		</div>
		<script>
			const myAudio = document.querySelector("#my-audio");
			myAudio.volume = 0.50;
			
			const audioContext = new AudioContext();
			const audioSourceNode = audioContext.createMediaElementSource(myAudio);
			const audioDestination = audioContext.destination;
			const gainNode = audioContext.createGain(); //볼룸 조절
			// const analyserNode  = new AnalyserNode(audioContext,{fftSize:32});
			const analyserNode  = audioContext.createAnalyser();// AnalyserNode(audioContext,{fftSize:32});

			analyserNode.fftSize=32;
			audioSourceNode
			.connect(analyserNode)
			.connect(gainNode)
			.connect(audioDestination)


			// gainNode.gain = 1; //추가 볼륨조절
			myAudio.addEventListener('canplay', (event) => {
				console.log(event.type,event);
			});
			myAudio.addEventListener('play', (event) => {
				console.log(event.type,event);
				audioContext.resume();
				start_draw_freqs();
			});
			myAudio.addEventListener('suspend', (event) => {
				console.log(event.type,event);
				audioContext.suspend();
				stop_draw_freqs();
			});
			myAudio.addEventListener('pause', (event) => {
				console.log(event.type,event);
				audioContext.suspend();
				stop_draw_freqs();
			});
			// myAudio.addEventListener('timeupdate', (event) => {
			// 	draw_freqs();
			// });
			let tm_draw_freqs;
			function start_draw_freqs(){
				tm_draw_freqs=setInterval(draw_freqs,100)
			}
			function stop_draw_freqs(){
				clearInterval(tm_draw_freqs);
			}


			audioContext.onstatechange=function(event){
				console.log(event.type,event);
			}
			function draw_freqs(){
				var bufferLength = analyserNode.frequencyBinCount;
				var dataArray = new Uint8Array(bufferLength);
				var dataArray2 = new Uint8Array(bufferLength);
				// analyserNode.getByteTimeDomainData(dataArray);
				analyserNode.getByteTimeDomainData(dataArray);
				analyserNode.getByteFrequencyData(dataArray2);
				app.timeDomains = dataArray
				app.freqs = dataArray2
				console.log(dataArray,dataArray2);
			}
		</script>
	</div>
	<div>
		<div id="app">
			
			<div class="row">
				<div class="col-lg-6 text-center">
					<h3>time-domain</h3>
					<template v-for="timeDomain in timeDomains">
						<progress min="0" max="256" :value="timeDomain"></progress><br>
					</template>
				</div>
				<div class="col-lg-6 text-center">
					<h3>frequency</h3>
					<template v-for="freq in freqs">
						<progress min="0" max="255" :value="freq"></progress><br>
					</template>
				</div>
			</div>
		</div>
	</div>
</body>
</html>