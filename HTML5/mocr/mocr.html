<!doctype html>
<html lang="ko" >
<head>
	<title>mocr</title>
	<meta charset="utf-8">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="shortcut icon" href="http://www.mins01.com/favicon.ico">
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<script src="/js/ForGoogle.js"></script>
	<!-- google analytics -->
	<script>ForGoogle.analytics()</script>


	<!-- jquery 관련 -->
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" crossorigin="anonymous"></script>


	<!-- 부트스트랩 4 : IE8지원안됨! -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" crossorigin="anonymous">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>
	<!-- vue.js -->
	<script src="https://cdn.jsdelivr.net/npm/vue"></script>

	<!-- meta og -->

	<meta property="og:title" content="mocr">
	<meta property="og:description" content="mocr">
	<meta name="og:image" content="http://www.mins01.com/img/logo.gif">
	<meta property="og:image:width" content="190">
	<meta property="og:image:height" content="70" />
	<meta property="og:site_name" content="mocr" />
	<meta property="og:type" content="website">

	<!-- //meta og -->
  <style media="screen">
    img , canvas {
      vertical-align:top ;
      outline: 1px dotted #000;
    }
		img , canvas  {
		  /* image-rendering: auto; */
		  /* image-rendering: crisp-edges; */
		  image-rendering: pixelated;
		}
		#div_in img{width:50px;}
		#div_dot{white-space: pre;font-family: monospace;}
		.letter-width32{width:32px;height:32px;display: inline-block;vertical-align: bottom; line-height: 1em;font-size: 32px}
		.div_input{ display: inline-block;vertical-align: bottom; line-height: 1em;font-size: 32px}
		.searched-letter{ display: inline-block;vertical-align: bottom; line-height: 1em;font-size: 14px; width:50px; height: 50px; text-align: center; white-space: pre;}

  </style>

  <script src="mocr\mocr.js"></script>
  <script src="mocr\mocr.Letter.js"></script>
  <script src="mocr\mocr.ImageTool.js"></script>
	<script src="mocr\mocr.ImageHandler.js"></script>
	<script src="mocr\mocr.LetterPackage.js"></script>
  <script src="mocr\mocr.LetterPackageGenerator.js"></script>
  <script type="text/javascript">
		var width = 32;
    var mit = mocr.ImageTool;
    var mih = new mocr.ImageHandler();
		var mih1 = new mocr.ImageHandler();
    var ml = null;
		var ml1 = null;
		var mlpg = new mocr.LetterPackageGenerator();
		mlpg.width=width
		var mlp = null;
    $(function(){
			$("#div_parsed").append(mih.canvas)
			mlp = mlpg.generate(null);
			mlpg.generate4Digit(mlp);
			mlpg.generate4Alphabet(mlp);
			//--- 테스트용 채우기
			// generateTestImage('a','z','Serif')
			// generateTestImage('A','Z','Serif')
			generateTestImage('a','z','Comic Sans MS')
			generateTestImage('A','Z','Comic Sans MS')


    })
		function onCheckImage(event){
			var ta = event.target;
			if(ta.tagName!='IMG') return false;
			checkImage(ta)
		}
		function checkImage(img){
			mih.loadFromImgNode(img);
      mih.simplify(width);
      ml = mih.getLetter();
			// mlp = mlpg.generate();
			var searched = mlp.search(ml);
			var diffBin = searched[0];
			console.log(diffBin.letter,diffBin.desc,diffBin.matched,diffBin.counts,diffBin.dot);
			$("#div_dot").text(diffBin.letter+"\n"+diffBin.desc+"\n"+diffBin.matched+"\n========================\n"+diffBin.dot)
			$(img).parent().find('.searched-letter').text(diffBin.letter+"\n"+diffBin.matched.toFixed(4))
		}
		function onCheckImage2(event){
			var ta = event.target;
			if(ta.tagName!='IMG') return false;
			checkImage2(ta)
		}
		function checkImage2(img){
			mih1.loadFromImgNode(img);
      mih1.simplify(width);
      ml1 = mih1.getLetter();
			// mlp = mlpg.generate();
			var diffBin = ml1.diffBin(ml);
			console.log(diffBin.letter,diffBin.desc,diffBin.matched,diffBin.counts,diffBin.dot);
			$("#div_dot").text(diffBin.letter+"\n"+diffBin.desc+"\n"+diffBin.matched+"\n========================\n"+diffBin.dot)
			// $(img).parent().find('.searched-letter').text(diffBin.letter)

		}
		function generateTestImage(stChar,edChar,fontFamily){
			var stCode = stChar.codePointAt(0);
			var edCode = edChar.codePointAt(0);
			// console.log(stCode,edCode);
			for(var i=stCode,m=edCode;i<=m;i++){
				var char = String.fromCodePoint(i);
				mih1.loadFromChar(char,fontFamily,'bold');
				// mih1.trim()
				$("#div_in").append('<div class="div_input"><img src="'+mih1.canvas.toDataURL()+'"><div class="searched-letter"></div></div>')
			}
		}
		$(function() {
			$("#div_in .div_input img").each(function(idx,el){
				checkImage(el);
			})
		})

  </script>

</head>
<body style="background-color:#eee;">
	<div class="container">
		<h1>mocr</h1>
		<h2>input image</h2>
    <div id="div_in" class="text-left m-1" onclick="onCheckImage(event);return false;">
			<div class="div_input"><img src="letter_0.png"><div class="searched-letter"></div></div>
			<div class="div_input"><img src="letter_1.png"><div class="searched-letter"></div></div>
			<div class="div_input"><img src="letter_2.png"><div class="searched-letter"></div></div>
			<div class="div_input"><img src="letter_3.png"><div class="searched-letter"></div></div>
			<div class="div_input"><img src="letter_4.png"><div class="searched-letter"></div></div>
			<div class="div_input"><img src="letter_5.png"><div class="searched-letter"></div></div>
			<div class="div_input"><img src="letter_6.png"><div class="searched-letter"></div></div>
			<div class="div_input"><img src="letter_7.png"><div class="searched-letter"></div></div>
			<div class="div_input"><img src="letter_8.png"><div class="searched-letter"></div></div>
			<div class="div_input"><img src="letter_9.png"><div class="searched-letter"></div></div>
    </div>
		<hr />
		<h2>parsed image</h2>
    <div id="div_parsed" class="text-center m-1">
    </div>
		<div class="row">
			<div class="col-lg-6">
				<hr />
				<h2>result</h2>
				<div id="div_dot" class="text-center m-1">
		    </div>
			</div>
			<div class="col-lg-6">
				<hr />
				<h2>letter collection</h2>
		    <div id="div_out" class="text-center m-1" onclick="onCheckImage2(event);return false;">
		    </div>
			</div>
		</div>

	</div>
</body>
</html>
