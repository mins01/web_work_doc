<!doctype html>
<html lang="ko" >
<head>
	<title>mocr2</title>
	<meta charset="utf-8">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<!-- <link rel="shortcut icon" href="http://www.mins01.com/favicon.ico"> -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<script src="/js/ForGoogle.js"></script>
	<!-- google analytics -->
	<script>ForGoogle.analytics()</script>


	<!-- jquery 관련 -->
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" crossorigin="anonymous"></script>


	<!-- 부트스트랩 4 : IE8지원안됨! -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" crossorigin="anonymous">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>
	<!-- vue.js -->
	<script src="https://cdn.jsdelivr.net/npm/vue"></script>

	<!-- meta og -->

	<meta property="og:title" content="mocr">
	<meta property="og:description" content="mocr">
	<meta property="og:site_name" content="mocr" />
	<meta property="og:type" content="website">

	<!-- //meta og -->
  <style media="screen">
    img , canvas {
      vertical-align:top;
      border: 1px solid #abc;
    }
		img , canvas  {
		  /* image-rendering: auto; */
		  /* image-rendering: crisp-edges; */
		  image-rendering: pixelated;
		}
		/* #div_in img{width:50px;} */
		#div_dot_info{white-space: pre; }
		#div_dot_dot{white-space: pre;font-family: monospace;line-height: 1em;font-size:10px; font-weight: bold}
		.letter-width32{width:32px;height:32px;display: inline-block;vertical-align: bottom; line-height: 1em;font-size: 32px}
		.div_input{ }
		.searched-letter{ display: inline-block;vertical-align: bottom; line-height: 1em;font-size: 14px; width:80px; height: 50px; text-align: center; white-space: pre;}
		.div_input2{position: relative;}
		.div_input2::before{pointer-events: none;position: absolute;width:100%;height: 100%; content: "";background-image: url('imgs/guide_100px.png');left: 0;right: 0;opacity: 0.2}
		.div_out_box{border: 1px solid rgba(100,0,0,0.5)}
		#div_suggest span{ display: inline-block;vertical-align: bottom; line-height: 1em;font-size: 14px; width:80px; height: 50px; text-align: center; white-space: pre;}
  </style>

	<script src="WC2/colorPalette.js"></script>
	<script src="WC2/colorPalette.palettes.js"></script>

  <script src="mocr/mocr.js"></script>
  <script src="mocr/mocr.Letter.js"></script>
	<script src="mocr/mocr.ImageTool.js"></script>
	<script src="mocr/mocr.ImageHandler.js"></script>
	<script src="mocr/mocr.LetterPackage.js"></script>
	<script src="mocr/mocr.LetterPackageGenerator.js"></script>
	<script src="mocr/mocr.BoundBoxTool.js"></script>
  <script src="mocr/mocr.ArrangedBoxes.js"></script>

  <script type="text/javascript">
		var width = 32;
    var mit = mocr.ImageTool;
    var mih = new mocr.ImageHandler();
		var mih1 = new mocr.ImageHandler();
    var ml = null;
		var ml1 = null;
		var mlss = [];
		var mlpg = new mocr.LetterPackageGenerator();
		mlpg.width=width
		var mlp = null;
		$(function(){

			// setTimeout(runTest,100)
		})
		function runTest(img_node,threshold){

			// var img_letter_0 = document.querySelector("#img_letter_0")
			mih.loadFromImgNode(img_node);

			$(".div_input2").append(mih.canvas);
			mih.toBWColor(255,255,255,threshold);

			// var boundBoxes = mih.getBoundBoxes();
			// console.log(boundBoxes);
			// return
			var abbs = mih.getArrangedBoundBoxes();
			// console.log(abbs);
			// return;

			// boundBoxes 범위 보여줌
			var ctx = mih.ctx;
			// // ctx.putImageData(imageData0,0,0);
			ctx.save();
			ctx.strokeStyle = 'rgba(0,0,100,255)';
			ctx.fillStyle = 'rgba(100,0,0,255)';
			ctx.lineWidth = 1;
			ctx.globalCompositeOperation ='multiply';
			ctx.globalAlpha = 0.6

			var tmep_mihs = [];
			$("#div_out").html("")
			$("#div_suggest").html("")
			mlss = [];
			for(var i=0,m=abbs.length;i<m;i++){
				mlss.push([])
				var mls = mlss[i];
				var abb = abbs[i];
				var div = document.createElement('div');

				div.className="div_out_box"
				$("#div_out").append(div)

				for(var i2=0,m2=abb.boundBoxes.length;i2<m2;i2++){

					var box = abb.boundBoxes[i2];
					var temp_mih = mih.generateImageHandlerFromBoundBox(box);
					var ml = temp_mih.getLetter()
					mls.push(ml)
					tmep_mihs.push(temp_mih);
					$(div).append(ml.toContext2d().canvas)

				}
			}

			for(var i=0,m=abbs.length;i<m;i++){
				var abb = abbs[i];
				// ctx.fillRect(abb.left,abb.top,abb.width+1,abb.height+1)
				ctx.strokeRect(abb.left,abb.top,abb.width+1,abb.height+1)
				for(var i2=0,m2=abb.boundBoxes.length;i2<m2;i2++){
				  var box = abb.boundBoxes[i2];
					ctx.fillRect(box.left,box.top,box.width+1,box.height+1)
				  // ctx.strokeRect(box.left,box.top,box.width+1,box.height+1)

				}
			}
			ctx.restore();
		}
		function runRuggesst(){
			mlp = mlpg.generate(null);
			mlpg.generate4Digit(mlp);
			mlpg.generate4Alphabet(mlp);
			mlpg.generate4Range(mlp,' ','/');
			//mlss
			for(var i=0,m=mlss.length;i<m;i++){
				var mls = mlss[i];
				mls.forEach((ml, i) => {
					var searched = mlp.search(ml);
					var div2 = document.createElement('div');
					$("#div_suggest").append(div2)
					$(div2).append('<img src="'+ml.toContext2d().canvas.toDataURL()+'">');
					searched.forEach((item, i) => {
						$(div2).append('<span>'+item.letter+'('+item.matched.toFixed(2)+')'+'</span>');
					});
				});
			}
		}

  </script>

</head>
<body style="background-color:#eee;">
	<div class="container">
		<h1>mocr2</h1>
		<h2>input image</h2>
    <div id="div_in" class="text-left m-1" >
			<div class="div_input">
				<img id="img_node_1" src="imgs/no_sweat.png">
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_1'),0)">test 0</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_1'),20)">test 20</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_1'),40)">test 40</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_1'),50)">test 50</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_1'),70)">test 70</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_1'),100)">test 100</button>
			</div>

			<div class="div_input">
				<img id="img_node_2" style="width:300px" src="imgs/namecard_0.png">
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_2'),0)">test 0</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_2'),20)">test 20</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_2'),40)">test 40</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_2'),50)">test 50</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_2'),70)">test 70</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_2'),100)">test 100</button>
			</div>
			<div class="div_input">
				<img id="img_node_3" style="width:300px" src="imgs/namecard_1.png">
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_3'),0)">test 0</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_3'),20)">test 20</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_3'),40)">test 40</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_3'),50)">test 50</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_3'),70)">test 70</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_3'),100)">test 100</button>
			</div>
			<div class="div_input">
				<img id="img_node_4" style="width:300px" src="imgs/alphabet_pangram.png">
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_4'),0)">test 0</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_4'),20)">test 20</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_4'),40)">test 40</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_4'),50)">test 50</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_4'),70)">test 70</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_4'),100)">test 100</button>
			</div>
			<div class="div_input">
				<img id="img_node_5" style="width:300px" src="imgs/hangul_pangram.png">
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_5'),0)">test 0</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_5'),20)">test 20</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_5'),40)">test 40</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_5'),50)">test 50</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_5'),70)">test 70</button>
				<button class="btn btn-info btn-lg" type="button" onclick="runTest(document.querySelector('#img_node_5'),100)">test 100</button>
			</div>
			<div class="div_input2"></div>
    </div>
		<h2>output text image</h2>
		<div id="div_out" class="text-left m-1" >

    </div>
		<h2>suggest text
			<button class="btn btn-info btn-lg" type="button" onclick="runRuggesst()">run suggest</button>
		</h2>
		<div id="div_suggest" class="text-left m-1" >

    </div>

	</div>
</body>
</html>
