<!doctype html>
<html lang="ko" >
<head>
	<title>canvas tools</title>
	<meta charset="utf-8">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="shortcut icon" href="http://www.mins01.com/favicon.ico">	
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<script src="/js/ForGoogle.js"></script>
	<!-- google analytics -->
	<script>if(window.ForGoogle){ ForGoogle.analytics() }else{ console.log("failure : ForGoogle.analytics()");}</script>
	

	<!-- jquery 관련 -->
	<!-- <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script> -->

	<!-- 부트스트랩 4 : IE8지원안됨! -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" crossorigin="anonymous"> 
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" crossorigin="anonymous"></script>  -->
	<!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script> -->
	<!-- vue.js -->
	<!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->
	

  <!-- https://fonts.google.com/specimen/Gugi -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- <link href="https://fonts.googleapis.com/css2?family=Gugi&display=swap" rel="stylesheet"> -->
  <link href="https://fonts.googleapis.com/css2?family=Gugi&display=swap" rel="stylesheet">

	<!-- meta og -->
	
	<meta property="og:title" content="canvas tools">
	<meta property="og:description" content="canvas tools">
	<meta name="og:image" content="http://www.mins01.com/img/logo.gif">
	<meta property="og:image:width" content="190">
	<meta property="og:image:height" content="70" />
	<meta property="og:site_name" content="canvas tools" />
	<meta property="og:type" content="website">
	
	<!-- //meta og -->
	<script src="canvasTools.js"></script>
  <style>
    canvas{
      outline: 1px solid #000; 
      background-image: url(bg.gif);
      margin:10px;
    }
  </style>
  <script>
    // let tb01 = new canvasTools.TextBox();
    window.addEventListener('load',(event)=>{
      var ctxConf={
        'font':'40px arial',
        fillStyle:'#369',
        // strokeStyle:'#000',
        strokeStyle:'transparent',
        textAlign:'center',
        textBaseline:"alphabetic", //이것만 사용하라 나머진 대응을..
        
      }
      var canvas = canvasTools.textBox(ctxConf,300,300,'A한bC글Txm 잘 되나요? 잘 되겠죠. 그러라고 만드는거니까요.',40)
      document.querySelector('#output_div_canvasTools_TextBox').append(canvas);

      var ctxConf={
        'font':'20px dotum bold',
        fillStyle:'#369',
        // strokeStyle:'#000',
        strokeStyle:'transparent',
        textAlign:'left'
      }
      var canvas = canvasTools.textBox(ctxConf,300,0,'A한bC글Txm 잘 되나요? 잘 되겠죠. 그러라고 만드는거니까요.',20,10) //높이를 0으로 하면 자동으로 높이 조절한다.
      document.querySelector('#output_div_canvasTools_TextBox').append(canvas);

      var ctxConf={
        'font':'20px dotum',
        fillStyle:'#369',
        // strokeStyle:'#000',
        strokeStyle:'transparent',
        textAlign:'right'
      }
      var canvas = canvasTools.textBox(ctxConf,300,0,'A한bC글Txm 잘 되나요? 잘 되겠죠. 그러라고 만드는거니까요.',20,10) //높이를 0으로 하면 자동으로 높이 조절한다.
      var canvas_text = canvas;
      document.querySelector('#output_div_canvasTools_TextBox').append(canvas);

      // 웹폰트 사용시 해당 글꼴이 사용할 수 있는 상태가 되야한다. css로 웹폰트 선언만으로는 안된다. HTML에서 해당 부분을 사용해야한다. 특히 구글폰트는 글자를 나눠 놓기 때문에 더욱 문제가 됨.
      document.fonts.load("50px Gugi", 'A한bC글Txm 잘 되나요? 잘 되겠죠. 그러라고 만드는거니까요.').then(()=>{ // 해당 폰트 사용에 대하서 로드 되도록 하는 구문.
        console.log('document.fonts.check',document.fonts.check("50px Gugi", 'A한bC글Txm 잘 되나요? 잘 되겠죠. 그러라고 만드는거니까요.')); // true가 나와야한다. false면 해당 폰트를 사용 못하는 경우다.
        var ctxConf={
          'font':'50px Gugi',
          fillStyle:'#369',
          strokeStyle:'#abc',
          lineWidth:3,
          // strokeStyle:'transparent',
          textAlign:'center'
        }
        var canvas = canvasTools.textBox(ctxConf,200,0,'A한bC글Txm 잘 되나요? 잘 되겠죠. 그러라고 만드는거니까요.',50) //웹폰트 적용
        document.querySelector('#output_div_canvasTools_TextBox').append(canvas);
        
      })
      
      
      var ctxConf={
        'font':'50px  arial',
        fillStyle:'#369',
        // strokeStyle:'#000',
        strokeStyle:'transparent',
        textAlign:'center'
      }
      var canvas = canvasTools.textBox(ctxConf,30,300,'A한bC글Txm 잘 되나요? 잘 되겠죠. 그러라고 만드는거니까요.',50) // 쫍은 너비
      document.querySelector('#output_div_canvasTools_TextBox').append(canvas);

      var ctxConf={
        'font':'50px  arial',
        fillStyle:'#369',
        strokeStyle:'#000',
        // strokeStyle:'transparent',
        textAlign:'center'
      }
      var canvas = canvasTools.textBox(ctxConf,50,300,'A한bC글Txm 잘 되나요? 잘 되겠죠. 그러라고 만드는거니까요.',50,10) // padding:10
      document.querySelector('#output_div_canvasTools_TextBox').append(canvas);

      var canvas = canvasTools.textBox(ctxConf,200,200,'배경: \n#fff + 높이 고정',50,20,'#fff') // 배경색
      document.querySelector('#output_div_canvasTools_TextBox').append(canvas);
      var canvas = canvasTools.textBox(ctxConf,200,0,'배경: #000',50,20,'#000') // 배경색
      document.querySelector('#output_div_canvasTools_TextBox').append(canvas);
      var canvas = canvasTools.textBox(ctxConf,200,0,'배경: rgba(0,0,0,0.3)',50,20,'rgba(0,0,0,0.3)') // 배경색
      document.querySelector('#output_div_canvasTools_TextBox').append(canvas);
      var canvas = canvasTools.textBox(ctxConf,200,0,'배경: #ff0000aa',50,20,'#ff0000aa') // 배경색
      document.querySelector('#output_div_canvasTools_TextBox').append(canvas);

      var canvas = canvasTools.textBox(ctxConf,300,0,'줄바꿈\n줄바꿈\n\n줄바꿈줄바꿈줄바꿈줄바꿈\n\n\n줄바꿈',50,20,'#abc') // 줄바꿈
      document.querySelector('#output_div_canvasTools_TextBox').append(canvas);

      var canvas = canvasTools.fromImage(document.querySelector('#img_fromImage'));
      document.querySelector('#output_div_canvasTools_fromImage').appendChild(canvas)

      // 중앙에 글자를 붙여 넣기

      document.fonts.load("50px Gugi", '테스트 글짜 뷁힣 입니다.').then(()=>{ // 해당 폰트 사용에 대하서 로드 되도록 하는 구문.
        console.log('document.fonts.check',document.fonts.check("50px Gugi", '테스트 글짜 뷁힣 입니다.')); // true가 나와야한다. false면 해당 폰트를 사용 못하는 경우다.
        var ctxConf={
          'font':'50px Gugi',
          fillStyle:'#369',
          strokeStyle:'#000',
          lineWidth:1,
          // strokeStyle:'transparent',
          textAlign:'center',

          shadowColor:"red",
          shadowBlur:15,
        }
        var canvas_text = canvasTools.textBox(ctxConf,200,0,'테스트 글짜 뷁힣 입니다.',50*1.5,20) //웹폰트 적용
        document.querySelector('#output_div_canvasTools_merge').appendChild(canvas_text)

        var canvas = canvasTools.fromImage(document.querySelector('#img_fromImage'));
        canvasTools.merge(canvas,canvas_text,
          0,0,canvas_text.width,canvas_text.height,
          Math.ceil((canvas.width-canvas_text.width)/2),Math.ceil((canvas.height-canvas_text.height)/2),canvas_text.width,canvas_text.height
          // 0,0,canvas_text.width,canvas_text.height
        )
        document.querySelector('#output_div_canvasTools_merge').appendChild(canvas)



        var ctxConf={
          'font':'30px serif',
          fillStyle:'#369',
          strokeStyle:'#000',
          lineWidth:1,
          // strokeStyle:'transparent',
          textAlign:'center',

          shadowColor:"red",
          shadowBlur:15,
        }
        // var canvasN = canvasTools.toCanvas(canvas); //복제함
        var canvasN = canvasTools.fromImage(document.querySelector('#img_fromImage'));

        var canvas_textN = canvasTools.textBox(ctxConf,200,0,'0도',30,30,'#aabbcc99')
        canvasTools.merge(canvasN,canvas_textN,
          0,0,canvas_textN.width,canvas_textN.height,
          0,0,canvas_textN.width,canvas_textN.height
          ,0
        )
        var canvas_textN = canvasTools.textBox(ctxConf,200,0,'45도',30,30,'#aabbcc99')
        canvasTools.merge(canvasN,canvas_textN,
          0,0,canvas_textN.width,canvas_textN.height,
          100,0,canvas_textN.width,canvas_textN.height
          ,45
        )
        var canvas_textN = canvasTools.textBox(ctxConf,200,0,'90도',30,30,'#aabbcc99')
        canvasTools.merge(canvasN,canvas_textN,
          0,0,canvas_textN.width,canvas_textN.height,
          200,0,canvas_textN.width,canvas_textN.height
          ,90
        )
        var canvas_textN = canvasTools.textBox(ctxConf,200,0,'135도',30,30,'#aabbcc99')
        canvasTools.merge(canvasN,canvas_textN,
          0,0,canvas_textN.width,canvas_textN.height,
          300,0,canvas_textN.width,canvas_textN.height
          ,135
        )
        var canvas_textN = canvasTools.textBox(ctxConf,200,0,'180도',30,30,'#aabbcc99')
        canvasTools.merge(canvasN,canvas_textN,
          0,0,canvas_textN.width,canvas_textN.height,
          0,300,canvas_textN.width,canvas_textN.height
          ,180
        )
        var canvas_textN = canvasTools.textBox(ctxConf,200,0,'225도',30,30,'#aabbcc99')
        canvasTools.merge(canvasN,canvas_textN,
          0,0,canvas_textN.width,canvas_textN.height,
          100,300,canvas_textN.width,canvas_textN.height
          ,225
        )
        var canvas_textN = canvasTools.textBox(ctxConf,200,0,'270도',30,30,'#aabbcc99')
        canvasTools.merge(canvasN,canvas_textN,
          0,0,canvas_textN.width,canvas_textN.height,
          200,300,canvas_textN.width,canvas_textN.height
          ,270
        )
        var canvas_textN = canvasTools.textBox(ctxConf,200,0,'315도',30,30,'#aabbcc99')
        canvasTools.merge(canvasN,canvas_textN,
          0,0,canvas_textN.width,canvas_textN.height,
          300,300,canvas_textN.width,canvas_textN.height
          ,315
        )
        var canvas_textN = canvasTools.textBox(ctxConf,200,0,'360도',30,30,'#aabbcc99')
        canvasTools.merge(canvasN,canvas_textN,
          0,0,canvas_textN.width,canvas_textN.height,
          0,600,canvas_textN.width,canvas_textN.height
          ,360
        )
        var canvas_textN = canvasTools.textBox(ctxConf,200,0,'-45도',30,30,'#aabbcc99')
        canvasTools.merge(canvasN,canvas_textN,
          0,0,canvas_textN.width,canvas_textN.height,
          100,600,canvas_textN.width,canvas_textN.height
          ,-45
        )
        var canvas_textN = canvasTools.textBox(ctxConf,200,0,'-90도',30,30,'#aabbcc99')
        canvasTools.merge(canvasN,canvas_textN,
          0,0,canvas_textN.width,canvas_textN.height,
          200,600,canvas_textN.width,canvas_textN.height
          ,-90
        )
        
        document.querySelector('#output_div_canvasTools_merge_with_rotate').appendChild(canvasN)

        



        var ctxConf={
          'font':'20px arial',
          fillStyle:'#369',
          strokeStyle:'#000',
          lineWidth:1,
          // strokeStyle:'transparent',
          textAlign:'center',

          shadowColor:"red",
          shadowBlur:15,
        }

        var canvasN = canvasTools.toCanvas(canvas); //복제함
        var canvas_text = canvasTools.textBox(ctxConf,canvasN.width,0,'canvasTools.toImage(canvas,cb,image/png)',20,20)
        canvasTools.merge(canvasN,canvas_text,
          0,0,canvas_text.width,canvas_text.height,
          0,0,canvas_text.width,canvas_text.height
          // 0,0,canvas_text.width,canvas_text.height
        )
        canvasTools.toImage(canvasN,(img)=>{
          img.width=300;
          document.querySelector('#output_div_canvasTools_merge').appendChild(img)
        },'image/png');

        var canvasN = canvasTools.toCanvas(canvas); //복제함
        var canvas_text = canvasTools.textBox(ctxConf,canvasN.width,0,'canvasTools.toImage(canvas,cb,image/jpeg,0.1)',20,20)
        canvasTools.merge(canvasN,canvas_text,
          0,0,canvas_text.width,canvas_text.height,
          0,0,canvas_text.width,canvas_text.height
          // 0,0,canvas_text.width,canvas_text.height
        )
        canvasTools.toImage(canvasN,(img)=>{
          img.width=300;
          document.querySelector('#output_div_canvasTools_merge').appendChild(img)
        },'image/jpeg',0.1);


        var canvasN = canvasTools.toCanvas(canvas); //복제함
        var canvas_text = canvasTools.textBox(ctxConf,canvasN.width,0,'canvasTools.toImageWithBlob(canvas,cb)',20,20)
        canvasTools.merge(canvasN,canvas_text,
          0,0,canvas_text.width,canvas_text.height,
          0,0,canvas_text.width,canvas_text.height
          // 0,0,canvas_text.width,canvas_text.height
        )
        canvasTools.toImageWithBlob(canvasN,(img)=>{
          img.width=300;
          document.querySelector('#output_div_canvasTools_merge').appendChild(img)
        });
        var canvasN = canvasTools.toCanvas(canvas); //복제함
        var canvas_text = canvasTools.textBox(ctxConf,canvasN.width,0,'canvasTools.toImageWithDataURL(canvas,cb)',20,20)
        canvasTools.merge(canvasN,canvas_text,
          0,0,canvas_text.width,canvas_text.height,
          0,0,canvas_text.width,canvas_text.height
          // 0,0,canvas_text.width,canvas_text.height
        )
        canvasTools.toImageWithDataURL(canvasN,(img)=>{
          img.width=300;
          document.querySelector('#output_div_canvasTools_merge').appendChild(img)
        });
      })
    })

    function download(filename,type,encoderOptions){
      var ctxConf={
          'font':'20px arial',
          fillStyle:'#369',
          strokeStyle:'#000',
          lineWidth:1,
          // strokeStyle:'transparent',
          textAlign:'center',

          shadowColor:"red",
          shadowBlur:15,
        }
      var canvas = canvasTools.fromImage(document.querySelector('#img_fromImage'));
      var canvas_text = canvasTools.textBox(ctxConf,canvas.width-50,0,`canvasTools.download(canvas,${filename},${type},${encoderOptions})`,20,20)
      canvasTools.merge(canvas,canvas_text,
        0,0,canvas_text.width,canvas_text.height,
        Math.ceil((canvas.width-canvas_text.width)/2),Math.ceil((canvas.height-canvas_text.height)/2),canvas_text.width,canvas_text.height
        // 0,0,canvas_text.width,canvas_text.height
      )
      canvasTools.download(canvas,filename,type,encoderOptions);
    }
    
    function downloadWithBlob(filename,type,encoderOptions){
      var ctxConf={
          'font':'20px arial',
          fillStyle:'#369',
          strokeStyle:'#000',
          lineWidth:1,
          // strokeStyle:'transparent',
          textAlign:'center',

          shadowColor:"red",
          shadowBlur:15,
        }
      var canvas = canvasTools.fromImage(document.querySelector('#img_fromImage'));
      var canvas_text = canvasTools.textBox(ctxConf,canvas.width-50,0,`canvasTools.downloadWithBlob(canvas,${filename},${type},${encoderOptions})`,20,20)
      canvasTools.merge(canvas,canvas_text,
        0,0,canvas_text.width,canvas_text.height,
        Math.ceil((canvas.width-canvas_text.width)/2),Math.ceil((canvas.height-canvas_text.height)/2),canvas_text.width,canvas_text.height
        // 0,0,canvas_text.width,canvas_text.height
      )
      canvasTools.downloadWithBlob(canvas,filename,type,encoderOptions);
    }
    function downloadWithDataURL(filename,type,encoderOptions){
      var ctxConf={
          'font':'20px arial',
          fillStyle:'#369',
          strokeStyle:'#000',
          lineWidth:1,
          // strokeStyle:'transparent',
          textAlign:'center',
          shadowColor:"red",
          shadowBlur:15,
        }
      var canvas = canvasTools.fromImage(document.querySelector('#img_fromImage'));
      var canvas_text = canvasTools.textBox(ctxConf,canvas.width-50,0,`canvasTools.downloadWithDataURL(canvas,${filename},${type},${encoderOptions})`,20,20)
      canvasTools.merge(canvas,canvas_text,
        0,0,canvas_text.width,canvas_text.height,
        Math.ceil((canvas.width-canvas_text.width)/2),Math.ceil((canvas.height-canvas_text.height)/2),canvas_text.width,canvas_text.height
        // 0,0,canvas_text.width,canvas_text.height
      )
      canvasTools.downloadWithDataURL(canvas,filename,type,encoderOptions);

    }

    function toBlob(cb,type,encoderOptions){
      var ctxConf={
          'font':'20px arial',
          fillStyle:'#369',
          strokeStyle:'#000',
          lineWidth:1,
          // strokeStyle:'transparent',
          textAlign:'center',

          shadowColor:"red",
          shadowBlur:15,
        }
      var canvas = canvasTools.fromImage(document.querySelector('#img_fromImage'));
      var canvas_text = canvasTools.textBox(ctxConf,canvas.width-50,0,`canvasTools.toBlob(canvas,cb,${type},${encoderOptions})`,20,20)
      canvasTools.merge(canvas,canvas_text,
        0,0,canvas_text.width,canvas_text.height,
        Math.ceil((canvas.width-canvas_text.width)/2),Math.ceil((canvas.height-canvas_text.height)/2),canvas_text.width,canvas_text.height
        // 0,0,canvas_text.width,canvas_text.height
      )
      canvasTools.toBlob(canvas,cb,type,encoderOptions);
    }
  </script>
</head>
<body>
	<div class="container">
    <h1>canvasTools</h1>
    <hr>
    <div>
      <!-- 웹폰트 로드를 위한 태그 -->
      <!-- <span style="font-family: Gugi;">A한bC글Txm 잘 되나요? 잘 되겠죠. 그러라고 만드는거니까요.</span> -->
    </div>
    <hr>
    <h2>canvasTools.textBox</h2>
    <div>
      <div id="output_div_canvasTools_TextBox">
        <div style=" background-image: url(bg.gif); width:300px;height:300px; font:40px arial;color:#369; line-height: 40px; text-align: center; outline: 1px solid #000; margin: 10px;white-space: normal; word-break: break-all; position: relative;"><div style="position: absolute;left:0;top:0">A한bC글Txm 잘 되나요? 잘 되겠죠. 그러라고 만드는거니까요.</div></div>
        <div>
          일반 text와 canvas의 text에서 textBaseline=top 설정에 따른 높이 계산에 오차가 있다... 방법이 안보인다.<br>
          textBaseline=alphabetic 을 사용하고, 한줄을 미리 내려서 출력하도록 했다.
        </div>
      </div>
    </div>
    <h3>canvasTools.fromImage</h3>
    <div>
      <div id="output_div_canvasTools_fromImage">
        <img id="img_fromImage" src="20221115182629545.png" width="100">
      </div>
    </div>
    <h3>canvasTools.merge</h3>
    <div>
      <div id="output_div_canvasTools_merge">
        
      </div>
    </div>
    <h3>canvasTools.merge with rotate</h3>
    <div>
      <div id="output_div_canvasTools_merge_with_rotate">
        
      </div>
    </div>
    <h3>download</h3>
    <div>
      <button type="button" class="btn btn-info m-1" onclick="download('test.png')">canvasTools.download</button>
      <button type="button" class="btn btn-info m-1" onclick="downloadWithBlob('test.png')">canvasTools.downloadWithBlob</button>
      <button type="button" class="btn btn-info m-1" onclick="downloadWithBlob('test.jpg','image/jpeg',0.1)">canvasTools.downloadWithBlob(...,'image/jpeg',0.1)</button>
      <button type="button" class="btn btn-info m-1" onclick="downloadWithDataURL('test.png')">canvasTools.downloadWithDataURL</button>
      <button type="button" class="btn btn-info m-1" onclick="downloadWithDataURL('test.jpg','image/jpeg',0.1)">canvasTools.downloadWithDataURL(...,'image/jpeg',0.1)</button>
    </div>

    <h3>toBlob , FormData</h3>
    <div>
      <button type="button" class="btn btn-info m-1" onclick="toBlob((blob)=>{console.log(blob);alert(blob.size+'byte, '+blob.type)})">toBlob</button>
      <button type="button" class="btn btn-info m-1" onclick="toBlob((blob)=>{
        let fd = new FormData;
        fd.append('upload_image',blob,'test.png');
        let file = fd.get('upload_image');
        console.log(file);
        alert(`upload_image : ${file.name} , ${file.type} , ${file.size}byte`);
        })">toBlob with FormData ex</button>
      <button type="button" class="btn btn-info m-1" onclick="toBlob((blob)=>{
          let fd = new FormData;
          fd.append('upload_image',blob,'test.jpg');
          let file = fd.get('upload_image');
          console.log(file);
          alert(`upload_image : ${file.name} , ${file.type} , ${file.size}byte`);
          },'image/jpeg',0.1)">toBlob with FormData ex ('image/jpeg',0.1)</button>
      
    </div>
	</div>
</body>
</html>